# 相関分析  

## 散布図  

- 相関関係  
2つの事象の間にある何らかの関係．  
e.g. 森林面積割合$\leftrightarrow$博物館

- 因果関係  
2つの事象のうち一方が原因となって他方の結果があるという関係．  
e.g. 気温$\to$扇風機の売り上げ

- 相関係数  
直線的な相関関係の強さを表す指標．  
$|r|<1$の値をとり，1に近いほど強い正の相関，-1に近いほど強い負の相関を示す．  
ただし，直線的な関係しか表せない．
$$r_{xy} = \frac{\frac{1}{n}\sum_i (x_i -\bar{x})(y_i-\bar{y})}{\sqrt{\frac{1}{n}\sum_i (x_i -\bar{x})} \sqrt{\frac{1}{n} \sum_i (y_i-\bar{y})}}$$

## 無相関の検定  
標本から算出した相関係数$r$とt分布を使って、母集団の相関係数が0かどうかを検定する．  
統計量tは自由度$n-2$のt分布に従う．
$$ t=\frac{|r|\sqrt{n-2}}{\sqrt{1-r^2}}$$
帰無仮説$H_0$を棄却するときに，2つの要素間で相関関係があると結論づける．  

## 母相関係数の信頼区間  
1. 母相関係数$\rho$の$z$変換
$$\zeta=\frac{1}{2}\log\frac{1+\rho}{1-\rho}$$
2. $n \to \infty, z \sim N(\zeta, \frac{1}{n-3})$を利用して，$z$を標準化する．
$$Z=\frac{z-\zeta}{1/\sqrt{n-3}}=\sqrt{n-3}(z-\zeta)$$
$$z-z_{\frac{\alpha}{2}} \sqrt{\frac{1}{n-3}} \leq \zeta \leq z+z_{\frac{\alpha}{2}} \sqrt{\frac{1}{n-3}}$$
3. $\zeta$を$\rho$に戻す．
$$\frac{e^{2z_L}-1}{e^{2z_L}+1} \leq \rho \leq \frac{e^{2z_U}-1}{e^{2z_U}+1}$$
$$z_L=z-z_{\frac{\alpha}{2}} \sqrt{\frac{1}{n-3}}, \quad z_R=z+z_{\frac{\alpha}{2}} \sqrt{\frac{1}{n-3}}$$

## 偏相関係数  
第3の因子の影響を除いた相関係数．  
見かけ上の相関がある場合に第3因子を考慮して相関関係を評価するために用いる．
$$r_{xy\cdot z} = \frac{r_{xy}-r_{xz}r_{yz}}{\sqrt{1-r_{xz}^2}\sqrt{1-r_{yz}^2}}$$
e.g. スクリーン数，薬局の数，人口密度をそれぞれ$x,y,z$とおくと，相関係数は$r_{xy}=0.82, r_{yz}=0.98, r_{zx}=0.85$となり，偏相関係数$r_{xy \cdot z}$は$-0.13$となる．  

$z$を考慮しない相関係数$r_{xy}$は$0.82$だったが，$z$を考慮すると偏相関係数$r_{xy \cdot z}$は$-0.13$であった．  
したがって，実際の$x,y$の相関はあまり強くないといえる．

## 層別解析  
データの中にいくつかの異なる性質の集団が含まれている場合に，データを分割して解析すること．  
e.g. 47都道府県のデータを「雪の多い都道府県」と「雪の少ない都道府県」の2つに分けて散布図を描画する．  